#same as FScleaner but for inodes. Tested, but needs bit more poking.
trap "rm -f $tempfile" 2; /var/opt/OV/bin/instrumentation/UXMONbroker -d dfmon &>/dev/null && tempfile="$HOME/tempfile1" dflog="/var/opt/OV/log/OpC/df_mon.log" alarm="DFMON: INODE warning CMA(NONE,NONE) FS=" FS=$(tail -3 $dflog | grep "$alarm" | awk '{print $11}' | cut -d "=" -f 2) threshold=$(tail -3 $dflog | grep "$alarm" | awk '{print $12}' | tr -d [A-z],\=,\%,) iusage=$(tail -3 $dflog | grep "$alarm" | awk '{print $13}' | tr -d [A-z],\=,\%,) && clear; if test -z $iusage || test -z $threshold || test -z $FS; then read -p "Which FS?: " FS clear; uname -a; date; uptime; echo; df -i $FS; echo; tail -2 $dflog; elif (( $iusage >= $threshold )); then printf "\nHello,\n\nWe have received the subject line notification regarding the server $(hostname).\n\nThe current inode utilization of the $FS filesystem is "; echo ""$iusage"%, while the threshold is "$threshold"%."; echo; df -i $FS && echo; cd $FS && printf "The directories using most of the indes can be found below:\n\n"; find . -xdev -printf '%h\n' | sort | uniq -c | sort -k 1 -n | tail -10 2>/dev/null > $tempfile && cat $tempfile; printf "\nThe largest directory ( $(cat $tempfile | tail -1 | awk '{print $2}') )is owned by the following user:\n" && echo; grep "^$(stat $(tail -1 $tempfile | awk '{print $2}') | grep Uid: | awk '{print $6'} | cut -d ")" -f 1)": /etc/passwd && printf "\nCould you please review and perform some housekeeping?\n\nThank you in advance.\n\nSincerely,\n\n"; fi; rm -f $tempfile &>/dev/null
