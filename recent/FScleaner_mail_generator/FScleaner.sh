#oneliner for fs cleanup
trap "rm -f $tempfilez $tempfile2 $theemail" 2; OS=$(uname); if [[ $OS = "Linux" ]]; then OS="--block-size=M" DF1="-h"; else OS="" DF1="-k";fi; read -p "Which FS?: " FS; tempfilez="$HOME/FScheck.temp" tempfile2="$HOME/Usercheck.temp" theemail="$HOME/theemail.txt" && printf "\n\nHello,\n\nWe have received the subject line notification regarding the server $(hostname).\n\nThe current utilization is:\n\n" >>$theemail && df $DF1 $FS >>$theemail && printf "\nThe largest files can be found below:\n\n">>$theemail && for i in $(find $FS -xdev -size +100000c -type f -exec du -k {} \; 2>/dev/null | sort -n -k 1 | tail -15 | awk '{print $2}'); do ls -l $OS -a $i; done | tee -a $tempfilez >> $theemail && printf "\nThe largest of the files belong to the following user/s:\n\n" >>$theemail && for k in $(cat $tempfilez | tail -5 | awk '{print $3}'); do grep "^$k:" /etc/passwd >> $tempfile2; done && sort -u $tempfile2 >>$theemail && rm -f $tempfilez $tempfile2 && printf "\nCould you please review and perform some housekeeping? \n\nThank you in advance. \n\nSincerely,\n\n" >> $theemail && if [[ $FS = "/var" || $FS = "/var/log" ]]; then echo && clear && uname -a; date; uptime; echo; df $DF1 $FS; printf "\nUsing logrotate -f /etc/logrotate.d...\n"; logrotate -f /etc/logrotate.d &> /dev/null || printf "An error was detected. Manual checking needed.\n\n"; read -p "Would you like to use eds-linux-patch? Doing so may remove staged packets y/n: " edspatch; if [[ $edspatch = "y" ]]; then printf "\nUsing eds-linux-patch -c...\n"; eds-linux-patch -c &>/dev/null || printf "An error was detected. Manual checking needed.\n\n"; fi; read -p "Would you like to use yum clean all? y/n: " yumclean; if [[ $yumclean = "y" ]]; then printf "Using yum clean all...\n"; yum clean all &> /dev/null || printf "An error was detected. Manual checking needed.\n\n"; fi; df $DF1 $FS; printf "\n\n\n\nIf an email will be needed, the information is below:"; sleep 5; cat $theemail; rm -f $theemail; elif [[ $FS = "/var/log/audit" ]]; then echo && clear && uname -a; date; uptime; echo; df $DF1 $FS; printf "\nUsing service auditd rotate...\n\n"; service auditd rotate &> /dev/null || printf "An error was detected. Manual checking needed.\n\n" && df $DF1 $FS; printf "\n\n\n\nIf an email will be needed, the information is below:"; sleep 5; cat $theemail; rm -f $theemail; else cat $theemail; rm -f $theemail; fi; rm -f $theemail $tempfilez $tempfile2 &>/dev/null
